<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<style type="text/css">
html{height:100%}  
body{height:100%;margin:0px;padding:0px}  
#container{width:600px;height:400px;margin:100px auto;}  
</style>
<script src ='http://www.web-jackiee.com/templets/blog/plug-in/jquery-2.2.0.min.js'></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=UpiGzKvHI69ewiB14LucBygfICIEmpvc"></script>
<script src = './distance.js'></script>
<title>地图展示</title>
</head>
<body>
<div id="container"></div> 
<div style="width:100%;height:340px;border:1px solid gray;float:left;border-left:none;"id="log"></div>
<script>
// var map = new BMap.Map("container");    
// var point = new BMap.Point(116.404, 39.915);    
// map.centerAndZoom(point, 15);    
// window.setTimeout(function(){  
//     map.panTo(new BMap.Point(116.422, 39.918));    
// }, 2000);                // 初始化地图，设置中心点坐标和地图级别
 
// map.addControl(new BMap.NavigationControl());    
// map.addControl(new BMap.ScaleControl({offset: new BMap.Size(375, 5)}));    
// map.addControl(new BMap.OverviewMapControl());    
// map.addControl(new BMap.MapTypeControl({offset: new BMap.Size(25, 5)}));   
// map.addControl(new BMap.GeolocationControl());    
// map.setCurrentCity("北京"); // 仅当设置城市信息时，MapTypeControl的切换功能才能可用
// var marker = new BMap.Marker(point);        // 创建标注    
// map.addOverlay(marker);                     // 将标注添加到地图中

// function addMarker(point, index){ 
//     var myIcon = new BMap.Icon("image/1.png", new BMap.Size(32, 24), {     
//        offset: new BMap.Size(10, 25),    
//        imageOffset: new BMap.Size(0, 0)
//     });      
//     var marker = new BMap.Marker(point, {icon: myIcon});   
//     map.addOverlay(marker);  
//     marker.enableDragging();
//     // marker.addEventListener("click", function(){    
//     //  alert("您点击了标注");    
//     // });  
// }    
// // 随机向地图添加10个标注    
// var bounds = map.getBounds();    
// var lngSpan = bounds.Ee - bounds.Je;    
// var latSpan = bounds.De - bounds.Ie;    
// for (var i = 0; i < 10; i ++) {    
// var point = new BMap.Point(bounds.Je + lngSpan * (Math.random() * 0.7 + 0.15),    
//     bounds.Ie + latSpan * (Math.random() * 0.7 + 0.15));    
//   //  console.log(point); 
//     addMarker(point, i);    
// }
// var opts = {    
//  width : 80,     // 信息窗口宽度    
//  height: 50,     // 信息窗口高度    
//  title : null // 信息窗口标题   
// }    
// var infoWindow = new BMap.InfoWindow("22", opts);  // 创建信息窗口对象  
// console.log(infoWindow);  
// map.openInfoWindow(infoWindow, map.getCenter());      // 打开信息窗口

// var polyline = new BMap.Polyline([    
//    new BMap.Point(116.399, 39.910),    
//    new BMap.Point(116.405, 39.920)    
//  ],    
//  {strokeColor:"blue", strokeWeight:6, strokeOpacity:0.5}    
// );    
// map.addOverlay(polyline);
// 百度地图API功能
    // var map = new BMap.Map("container");
    // map.centerAndZoom(new BMap.Point(116.404, 39.915), 15);

    // var myP1 = new BMap.Point(116.380967,39.913285);    //起点
    // var myP2 = new BMap.Point(116.424374,39.914668);    //终点
    // var myIcon = new BMap.Icon("http://developer.baidu.com/map/jsdemo/img/Mario.png", new BMap.Size(32, 70), {    //小车图片
    //     //offset: new BMap.Size(0, -5),    //相当于CSS精灵
    //     imageOffset: new BMap.Size(0, 0)    //图片的偏移量。为了是图片底部中心对准坐标点。
    //   });
    // var driving2 = new BMap.DrivingRoute(map, {renderOptions:{map: map, autoViewport: true}});    //驾车实例
    // driving2.search(myP1, myP2);    //显示一条公交线路

    // window.run = function (){
    //     var driving = new BMap.DrivingRoute(map);    //驾车实例
    //     driving.search(myP1, myP2);
    //     driving.setSearchCompleteCallback(function(){
    //         var pts = driving.getResults().getPlan(0).getRoute(0).getPath();    //通过驾车实例，获得一系列点的数组
    //         var paths = pts.length;    //获得有几个点

    //         var carMk = new BMap.Marker(pts[0],{icon:myIcon});
    //         map.addOverlay(carMk);
    //         i=0;
    //         function resetMkPoint(i){
    //             carMk.setPosition(pts[i]);
    //             if(i < paths){
    //                 setTimeout(function(){
    //                     i++;
    //                     resetMkPoint(i);
    //                 },100);
    //             }
    //         }
    //         setTimeout(function(){
    //             resetMkPoint(5);
    //         },100)

    //     });
    // }

    // setTimeout(function(){
    //     run();
    // },1500);


// var map = new BMap.Map("container");         // 创建地图实例      
// var point = new BMap.Point(116.404, 39.915);  // 创建点坐标     
// map.centerAndZoom(point, 15);                 // 初始化地图，设置中心点坐标和地图级别     
// var traffic = new BMap.TrafficLayer();        // 创建交通流量图层实例      
// map.addTileLayer(traffic);                    // 将图层添加到地图上若要从地图上移除图层，需要调用map.removeTileLayer方法。
// //map.removeTileLayer(traffic);                // 将图层移除

// var map = new BMap.Map("container");          // 创建地图实例     
// var point = new BMap.Point(116.404, 39.915);  // 创建点坐标     
// map.centerAndZoom(point,15);                  // 初始化地图，设置中心点坐标和地图级别     
// var tilelayer = new BMap.TileLayer();         // 创建地图层实例    
// tilelayer.getTilesUrl=function(){             // 设置图块路径     
//           return "layer.gif";      
// };      
// map.addTileLayer(tilelayer);                // 将图层添加到地图上

// var map = new BMap.Map("container");      
// map.centerAndZoom(new BMap.Point(116.404, 39.915), 11);      
// var local = new BMap.LocalSearch(map, {      
//       renderOptions:{map: map}      
// });      
// local.search("长城");

// var map = new BMap.Map("container");    
// map.centerAndZoom(new BMap.Point(116.404, 39.915), 14);  
// var local = new BMap.LocalSearch("北京市",   
//             {renderOptions: {map: map,autoViewport: true},pageCapacity: 8});      
// local.search("小肥羊");

// var map = new BMap.Map("container");          
// map.centerAndZoom(new BMap.Point(116.404, 39.915), 11);      
// var options = {      
//       onSearchComplete: function(results){    
//           if (local.getStatus() == BMAP_STATUS_SUCCESS){      
//                 // 判断状态是否正确      
//                 var s = [];      
//                 for (var i = 0; i < results.getCurrentNumPois(); i ++){      

//                     s.push(results.getPoi(i).title + ", " + results.getPoi(i).address);      
//                 }      
//              document.getElementById("log").innerHTML = s.join("<br>");      
//           }      
//       }      
//  };      
// var local = new BMap.LocalSearch(map, options);      
// local.search("小肥羊");

// var map = new BMap.Map("container");    
// map.centerAndZoom(new BMap.Point(116.404, 39.915), 14);    
// var transit = new BMap.TransitRoute(map, {    
//  renderOptions: {map: map}    
// });    
// transit.search("王府井", "西单");

// var map = new BMap.Map("container");    
// map.centerAndZoom(new BMap.Point(116.404, 39.915), 14);    
// var transit = new BMap.TransitRoute(map, {    
//  renderOptions: {map: map, panel: "results"}    
// });    
// transit.search("王府井", "西单");

// var map = new BMap.Map("container");    
// map.centerAndZoom(new BMap.Point(116.404, 39.915), 12);    
// var transit = new BMap.TransitRoute("北京市");    
// transit.setSearchCompleteCallback(function(results){    
//  if (transit.getStatus() == BMAP_STATUS_SUCCESS){    
//    var firstPlan = results.getPlan(0);    
//    // 绘制步行线路    
//    for (var i = 0; i < firstPlan.getNumRoutes(); i ++){    
//      var walk = firstPlan.getRoute(i);    
//      if (walk.getDistance(false) > 0){    
//        // 步行线路有可能为0  
//        map.addOverlay(new BMap.Polyline(walk.getPoints(), {lineColor: "green"}));    
//      }    
//    }    
//   // 绘制公交线路   
//    for (i = 0; i < firstPlan.getNumLines(); i ++){    
//      var line = firstPlan.getLine(i);    
//      map.addOverlay(new BMap.Polyline(line.getPoints()));    
//    }    
//    // 输出方案信息  
//    var s = [];    
//    for (i = 0; i < results.getNumPlans(); i ++){    
//      s.push((i + 1) + ". " + results.getPlan(i).getDescription());    
//    }    
//    document.getElementById("log").innerHTML = s.join("<br>");    
//  }    
// })    
// transit.search("中关村", "国贸桥");

// var map = new BMap.Map("container");    
// map.centerAndZoom(new BMap.Point(116.404, 39.915), 14);   
// var transit = new BMap.TransitRoute(map, {
//     renderOptions: {
//         map: map,
//         panel: 'panel'
//     }
// });
// transit.search('西单', '小肥羊');
// transit.search(new BMap.Point(116.315157,39.987946), 
//                new BMap.Point(116.371499,39.880394));
// transit.search({title: '我这里', point: new BMap.Point(116.315157,39.987946)}, 
//                {title: '你这里', point: new BMap.Point(116.371499,39.880394)});



// var map = new BMap.Map("container");    
// map.centerAndZoom(new BMap.Point(116.404, 39.915), 14);
// var transit = new BMap.TransitRoute('北京', {
//     onSearchComplete: function(result) {
//         console.log(result);
//         if (transit.getStatus() == BMAP_STATUS_SUCCESS) {
//             // 从结果对象中获取起点和终点信息
//             var start = result.getStart();
//             var end = result.getEnd();
//             addStart(start.point, start.title);
//             addEnd(end.point, end.title);
//             // 直接获取第一个方案
//             var plan = result.getPlan(0);
//             // 遍历所有步行线路
//             for (var i = 0; i < plan.getNumRoutes(); i++) {
//                 if (plan.getRoute(i).getDistance(false) > 0) {
//                     // 判断只有大于0的步行线路才会绘制
//                     addWalkRoute(plan.getRoute(i).getPath());
//                 }
//             }
//             // 遍历所有公交线路
//             var allLinePath = [];
//             for (i = 0; i < plan.getNumLines(); i++) {
//                 allLinePath = allLinePath.concat(plan.getLine(i).getPath());
//                 addLine(plan.getLine(i).getPath());
//             }
//             // 最后根据公交线路的点设置地图视野
//             map.setViewport(allLinePath);
//         }
//     }
// });

// transit.search('北京大学', '北京交通大学');

// // 添加起点覆盖物
// function addStart(point, title){
//     map.addOverlay(new BMap.Marker(point, {
//         title: title,
//         icon: new BMap.Icon('http://images.cnblogs.com/cnblogs_com/jz1108/329471/o_blue.png', new BMap.Size(38, 41), {
//             anchor: new BMap.Size(4, 36)
//         })}));
// }

// // 添加终点覆盖物
// function addEnd(point, title){
//     map.addOverlay(new BMap.Marker(point, {
//         title: title,
//         icon: new BMap.Icon('http://images.cnblogs.com/cnblogs_com/jz1108/329471/o_red.png', new BMap.Size(38, 41), {
//             anchor: new BMap.Size(4, 36)
//         })}));
// }

// // 添加路线
// function addWalkRoute(path){
//     map.addOverlay(new BMap.Polyline(path, {
//         strokeColor: 'black',
//         strokeOpacity: 0.7,
//         strokeWeight: 4,
//         strokeStyle: 'dashed',
//         enableClicking: false
//     }));
// }

// function addLine(path){
//     map.addOverlay(new BMap.Polyline(path, {
//         strokeColor: 'blue',
//         strokeOpacity: 0.6,
//         strokeWeight: 5,
//         enableClicking: false
//     }));
// }

                // var geolocation = new BMap.Geolocation();
                // geolocation.getCurrentPosition(function(r){
                // if(this.getStatus() == BMAP_STATUS_SUCCESS){
                //  var mk = new BMap.Marker(r.point);
                //  map.addOverlay(mk);
                //  map.panTo(r.point);
                //  console.log('您的位置：'+r.point.lng+','+r.point.lat);
                // }
                // else {
                //  alert('failed'+this.getStatus());
                // }        
                // },{enableHighAccuracy: true})

// var map = new BMap.Map("container");      
// map.centerAndZoom(new BMap.Point(121.446495,31.13837), 11);      
// var local = new BMap.LocalSearch(map, {      
//       renderOptions:{map: map}      
// });      
// local.search("徐汇区老沪闵路809号好又多正门附近");

// var map = new BMap.Map("container");    
// map.centerAndZoom(new BMap.Point(116.404, 39.915), 14);    
// var transit = new BMap.TransitRoute(map, {    
//  renderOptions: {map: map}    
// });    
// transit.search("王府井", "西单");
// var map = new BMap.Map("container");
// map.centerAndZoom(new BMap.Point(116.404, 39.915), 14);

// function milkSearchFun(){
// var milkStartTitle = tansit.getResults().getStart().title;  //公交导航起点的名字
// var milkEndTitle = tansit.getResults().getEnd().title;  //公交导航终点的名字
// var milkPlan = tansit.getResults().getPlan(0);   //获取第一条公交导航
// var milkDescription = milkPlan.getDescription();    //获取第一条公交导航的全部描述（带html）
    
//     var milkLine = milkPlan.getLine(0).title;       //获取公交线路（比如331路）的名称
// var milkLineGeton = milkPlan.getLine(0).getGetOnStop().title;       //获取上车点站名
// var milkLineGetoff = milkPlan.getLine(0).getGetOffStop().title;     //获取下车点站名
    
//     var milkRouteNum = milkPlan.getNumRoutes();   //提前判断一下，如果为2，即表示无换乘.
// var milkRouteStart = milkPlan.getRoute(0).getDistance();  //从起点到上车车站的距离
// var milkRouteEnd = milkPlan.getRoute(1).getDistance();      //从下车车站到终点的距离
       
//     document.getElementById("milkResult").innerHTML = 
//         "<p style='background:url(start.jpg) no-repeat 0 center;padding:0 0 0 30px'><b style='color:#fff;background:#ff55cc;padding:2px;'>" + milkStartTitle + "</b></p>" + 
//         "<p style='background:url(walk.jpg) no-repeat 0 center;padding:0 0 0 30px'>步行<b>" + milkRouteStart + "</b>，至" + milkStartTitle + "</p>" +
//         "<p style='background:url(bus.jpg) no-repeat 0 center;padding:0 0 0 30px'>在<b>" + milkLineGeton + "</b>上车,乘坐<b>" + milkLine + "</b>,在<b>" + milkLineGetoff + "</b>下车</p>" +
//         "<p style='background:url(walk.jpg) no-repeat 0 center;padding:0 0 0 30px'>步行<b>" + milkRouteEnd + "</b>，至终点</p>" +
//         "<p style='background:url(end.jpg) no-repeat 0 center;padding:0 0 0 30px'><b style='color:#fff;background:#ff55cc;padding:2px;'>" + milkEndTitle + "</b></p>";
    
// }

// var tansit = new BMap.TransitRoute(map, {renderOptions:{map: map, autoViewport: true}, onSearchComplete:fn});
//tansit.search("故宫", "颐和园");


// var map = new BMap.Map("container");
//map.centerAndZoom();

// var driving = new BMap.DrivingRoute(map, {renderOptions: {map: map},onSearchComplete:fn});
// driving.search("中关村一街", "魏公村");



// var driving = new BMap.DrivingRoute(map, {renderOptions: {map: map},onSearchComplete:fn});
// driving.search("徐汇区长桥八村27号", "普陀区金沙江路2号");

// function fn(res){
//     console.log(res);
// }


// var map = new BMap.Map("container");
// map.centerAndZoom(new BMap.Point(116.404, 39.915), 12);

// var driving = new BMap.DrivingRoute(map, {renderOptions: {map: map, panel: "r-result", autoViewport: true}});
// driving.search("中关村一街", "魏公村");




// getDriveDistance(
//     {
//         pois : {
//             start: {
//                 addr : '徐汇区长桥八村27号',
//                 address : {
//                     city : '上海市'
//                 }
//             },
//             end: {
//                 addr : '徐汇区长桥一村1号',
//                 address : {
//                     city : '上海市'
//                 }
//             },
//         },
//     },
//     function(res){
//         console.log(res)
//     },
//     function(err){
//         console.log(err);
//     }
// )




// function getDriveDistance(driveStatus,success,fail){
//     var _this = this;
//     var tryAgain = false;
//     var start = driveStatus.pois.start,
//         end = driveStatus.pois.end,
//         startAddr, endAddr;
//         startAddr = start.point? start.point.lat.toFixed(6)+','+start.point.lng.toFixed(6) : start.addr;
//         endAddr = end.point? end.point.lat.toFixed(6)+','+end.point.lng.toFixed(6) : end.addr;
//     $.ajax({
//         url: "http://api.map.baidu.com/direction/v1",
//         type: "GET",
//         data: {
//           ak: 'UpiGzKvHI69ewiB14LucBygfICIEmpvc',
//           mode : "driving",
//           origin : startAddr,
//           destination : endAddr,
//           origin_region : driveStatus.pois.start.address.city,
//           destination_region : driveStatus.pois.end.address.city,
//           output : "json"
//         },
//         dataType:'jsonp',
//         jsonp: "callback",//传递给请求处理程序或页面的，用以获得jsonp回调函数名的参数名(默认为:callback)
//         jsonpCallback:"success",//自定义的jsonp回调函数名称，默认为jQuery自动生成的随机函数名
//     })
//     .done(function(data){
//         console.log(driveStatus);
//         if(data.type != 1 && data.result && data.result.routes){
//             driveStatus.routes = data.result.routes;
//             driveStatus.duration = driveStatus.routes[0].duration;
//             driveStatus.distance = driveStatus.routes[0].distance;
//             if(driveStatus.distance > 10000){
//                 driveStatus.distance = (driveStatus.distance/1000).toFixed(2) + '公里';
//             }else{
//                 driveStatus.distance += '米';
//             }
//             success && success.call(_this,data)
//         }else if(data.type == 1 && !tryAgain){
//             var origin = data.result.origin.content;
//             var destination = data.result.destination.content;
//             if( origin && origin.length && destination && destination.length){
//                 start.lng = origin[0].location.lng;
//                 start.lat = origin[0].location.lat;
//                 end.lng = destination[0].location.lng;
//                 end.lat = destination[0].location.lat;
//                 tryAgain = true;
//                 //_this.initPois(driveStatus.pois);
//                 //getDriveDistance(driveStatus,success,fail);
//             }
//         }
//     })
// }


// var map = new BMap.Map("container");
// map.centerAndZoom(new BMap.Point(116.404, 39.915), 15);
// var myDis = new BMapLib.DistanceTool(map);
// myDis.open();

// var map = new BMap.Map("container");  
// // var point = new BMap.Point(116.404, 39.915);  
// // map.centerAndZoom(point,12);  
  
// var output = "从上地到西单驾车需要";  
// var searchComplete = function (results){  
//     if (transit.getStatus() != BMAP_STATUS_SUCCESS){  
//         return ;  
//     }  
    
//         var plan = results.getPlan(0);  
//         output += plan.getDuration(true) + "\n";                //获取时间  
//         output += "总路程为：" ;  
//         output += plan.getDistance(true) + "\n";             //获取距离  
// }  

// var transit = new BMap.DrivingRoute(map, {renderOptions: {map: map},  
//     onSearchComplete: searchComplete,  
//     onPolylinesSet: function(){          
//         setTimeout(function(){alert(output)},"1000");  
// }});  
// transit.search("上海市徐汇区长桥八村", "上海市徐汇区长桥一村");  


// var map = new BMap.Map("container");    
// map.centerAndZoom(new BMap.Point(116.404, 39.915), 14);    
// var options = {    
//  onSearchComplete: function(results){  
//    if (driving.getStatus() == BMAP_STATUS_SUCCESS){    
//      console.log(results)  
//      // 获取第一条方案   
//      var plan = results.getPlan(0);      
//      // 获取方案的驾车线路   
//      var route = plan.getRoute(0);      
//      // 获取每个关键步骤，并输出到页面   
//      var s = [];    
//      for (var i = 0; i < route.getNumSteps(); i ++){    
//        var step = route.getStep(i);    
//        s.push((i + 1) + ". " + step.getDescription());    
//      }    
//      document.getElementById("log").innerHTML = s.join("<br>");    
//    }    
//     }    
// };    
// var driving = new BMap.DrivingRoute(map, options);    
// driving.search("徐汇区长桥八村27号", "徐汇区长桥一村1号");


var map = new BMap.Map();    
var pointData = {};
 
var driving = new BMap.DrivingRoute(map,{
    onSearchComplete: function(results){   
    if (driving.getStatus() == BMAP_STATUS_SUCCESS){   
     console.log(results.ur[0].Oq/60)  
      console.log(results.ur[0].cg/1000)  
    }    
 }  
});  

requestPoints('徐汇区长桥八村27号',map,'adminPoints',function(){
    requestPoints('长宁区安龙路929弄3号',map,'shopPoints',function(){
        driving.search(pointData.adminPoints,pointData.shopPoints);
    })
})


function requestPoints(adress,map,attr,cb){
    var area = '上海市',
        myGeo = new BMap.Geocoder();      
        myGeo.getPoint(adress, function(point){     
            pointData[attr] = new BMap.Point(point.lng,point.lat);
            cb&&cb();
        },area);
}




</script>  
</script>
</body>
</html>